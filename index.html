<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Course Information – Local Golf Database</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --green: #244f3c;
      --green-dark: #163023;
      --gold: #d1a14b;
      --cream: #f5f0e6;
      --bg: #fcfaf6;
      --text: #222;
      --radius: 14px;
      --shadow: 0 10px 28px rgba(0,0,0,.08);
      --muted: #6b7280;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #fdf7eb 0, #f3efe7 40%, #e7e1d3 100%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 16px 24px;
      background: linear-gradient(120deg, var(--green-dark), var(--green));
      color: #fefcf5;
      box-shadow: 0 4px 18px rgba(0,0,0,.25);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    header h1 {
      margin: 0;
      font-size: 1.4rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }

    header p {
      margin: 4px 0 0;
      font-size: 0.9rem;
      opacity: 0.9;
    }

    main {
      flex: 1;
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
      display: grid;
      grid-template-columns: minmax(220px, 260px) minmax(0, 1fr);
      gap: 16px;
      padding: 16px;
    }

    @media (max-width: 900px) {
      main {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      background: rgba(252, 249, 242, 0.95);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      border: 1px solid rgba(0,0,0,0.04);
      padding: 14px 16px;
      backdrop-filter: blur(8px);
    }

    .panel h2 {
      margin: 0 0 8px;
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--green-dark);
    }

    .panel small {
      color: var(--muted);
    }

    /* ===== COURSE LIST ===== */
    #coursesList {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 8px;
    }

    .course-pill {
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.06);
      background: #fdfaf3;
      display: flex;
      flex-direction: column;
      cursor: pointer;
      transition: transform 0.12s ease, box-shadow 0.12s ease, border-color 0.12s ease, background 0.12s ease;
    }

    .course-pill:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      background: #fffaf0;
    }

    .course-pill.active {
      background: #183c2c;
      color: #fdf7eb;
      border-color: rgba(255,255,255,0.4);
    }

    .course-pill-title {
      font-size: 0.95rem;
      font-weight: 600;
    }

    .course-pill-meta {
      font-size: 0.8rem;
      opacity: 0.85;
    }

    .muted {
      color: var(--muted);
      font-size: 0.9rem;
    }

    .error {
      color: #b91c1c;
      font-size: 0.9rem;
      margin-top: 6px;
    }

    /* ===== COURSE HEADER / BADGES ===== */
    .course-header {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 12px;
      border-bottom: 1px solid rgba(0,0,0,0.12);
      padding-bottom: 8px;
    }

    .course-header-main h3 {
      margin: 0;
      font-size: 1.1rem;
    }

    .course-header-main p {
      margin: 2px 0 0;
      font-size: 0.85rem;
      color: var(--muted);
    }

    .course-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: flex-start;
    }

    .badge {
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
      border: 1px solid rgba(0,0,0,0.06);
      background: #f6f1e6;
      color: var(--green-dark);
      white-space: nowrap;
    }

    .badge-pill {
      background: #183c2c;
      color: #fefcf5;
      border-color: transparent;
    }

    /* ===== TEES LEGEND ===== */
    #teesInfo {
      margin-bottom: 12px;
      font-size: 0.82rem;
      color: var(--muted);
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    #teesInfo span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 7px;
      border-radius: 999px;
      background: rgba(0,0,0,0.03);
    }

    .tee-dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.15);
      background: #e5e7eb;
    }

    /* ===== SCORECARD TABLE ===== */
    .scorecard-wrapper {
      max-width: 100%;
      overflow-x: auto;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,0.08);
      background: #fffdf6;
    }

    table.scorecard {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.82rem;
      table-layout: fixed;
    }

    .scorecard thead {
      background: #efe4d0;
    }

    .scorecard th,
    .scorecard td {
      padding: 6px 6px;
      text-align: center;
      border-bottom: 1px solid rgba(0,0,0,0.06);
      border-right: 1px solid rgba(0,0,0,0.06);
      white-space: nowrap;
    }

    .scorecard th:first-child,
    .scorecard td:first-child {
      text-align: left;
      font-weight: 600;
      background: #f4ead7;
      position: sticky;
      left: 0;
      z-index: 1;
    }

    .scorecard tr:nth-child(even) td {
      background: rgba(0,0,0,0.01);
    }

    .scorecard tfoot td {
      font-weight: 600;
      background: #e8ddca;
    }

    .scorecard th.group-label {
      background: #e0d2bd;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .scorecard th.total-col,
    .scorecard td.total-col {
      background: #f0e5cf;
      font-weight: 600;
    }

    .scorecard th.out-in-col,
    .scorecard td.out-in-col {
      background: #f2e7d2;
      font-weight: 600;
    }

    .tee-name-cell {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .tee-name-swatch {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.15);
    }
  </style>
</head>
<body>
  <header>
    <h1>Local Course Information</h1>
    <p>A lightweight yardage book. Data lives in /data; this page just reads it.</p>
  </header>

  <main>
    <!-- LEFT: COURSE LIST -->
    <section class="panel">
      <h2>Courses</h2>
      <small>Select a course to view its holes, pars, and tee yardages.</small>
      <div id="coursesList"></div>
      <div id="coursesError" class="error" style="display:none;"></div>
    </section>

    <!-- RIGHT: SCORECARD -->
    <section class="panel">
      <h2>Course Detail</h2>
      <div id="courseDetail">
        <p class="muted">Choose a course on the left to see its scorecard-style layout.</p>
      </div>
    </section>
  </main>

  <script>
    var COURSES_INDEX_PATH = "data/courses.json";

    function fetchJSON(path) {
      return fetch(path).then(function(res) {
        if (!res.ok) {
          throw new Error("HTTP " + res.status + " for " + path);
        }
        return res.json();
      });
    }

    function loadCourses() {
      var listEl = document.getElementById("coursesList");
      var errorEl = document.getElementById("coursesError");
      listEl.innerHTML = "<p class='muted'>Loading courses…</p>";
      errorEl.style.display = "none";

      fetchJSON(COURSES_INDEX_PATH)
        .then(function(courses) {
          if (!Array.isArray(courses) || courses.length === 0) {
            listEl.innerHTML = "<p class='muted'>No courses found in data/courses.json.</p>";
            return;
          }
          renderCourseList(courses);
          var first = courses[0];
          if (first) {
            setActiveCoursePill(first.id);
            loadCourse(first.id);
          }
        })
        .catch(function(err) {
          console.error("[courses] Failed to load", err);
          listEl.innerHTML = "";
          errorEl.textContent = "Could not load " + COURSES_INDEX_PATH + " – " + err.message;
          errorEl.style.display = "block";
        });
    }

    function renderCourseList(courses) {
      var listEl = document.getElementById("coursesList");
      listEl.innerHTML = "";

      courses.forEach(function(course) {
        var pill = document.createElement("button");
        pill.type = "button";
        pill.className = "course-pill";
        pill.dataset.courseId = course.id;

        var title = document.createElement("span");
        title.className = "course-pill-title";
        title.textContent = course.name || "Unnamed Course";

        var meta = document.createElement("span");
        meta.className = "course-pill-meta";

        var city = course.city || "";
        var state = course.state || "";
        var holes = course.holes;

        var metaText = city;
        if (city && state) {
          metaText += ", " + state;
        } else if (state) {
          metaText = state;
        }
        if (holes) {
          if (metaText) metaText += " · ";
          metaText += holes + " holes";
        }
        meta.textContent = metaText;

        pill.appendChild(title);
        pill.appendChild(meta);

        pill.addEventListener("click", function() {
          setActiveCoursePill(course.id);
          loadCourse(course.id);
        });

        listEl.appendChild(pill);
      });
    }

    function setActiveCoursePill(courseId) {
      var pills = document.querySelectorAll(".course-pill");
      pills.forEach(function(pill) {
        pill.classList.toggle("active", pill.dataset.courseId === courseId);
      });
    }

    function loadCourse(courseId) {
      var container = document.getElementById("courseDetail");
      container.innerHTML = "<p class='muted'>Loading course data…</p>";

      var basePath = "data/courses/" + courseId;
      var coursePath = basePath + "/course.json";
      var holesPath = basePath + "/holes.json";

      Promise.all([
        fetchJSON(coursePath),
        fetchJSON(holesPath)
      ])
      .then(function(results) {
        var course = results[0];
        var holes = results[1];
        renderCourseDetail(course, holes);
      })
      .catch(function(err) {
        console.error("[course] Failed to load", courseId, err);
        container.innerHTML =
          "<p class='error'>Could not load <code>" +
          courseId +
          "</code> data. Check that <code>" +
          coursePath +
          "</code> and <code>" +
          holesPath +
          "</code> exist and are valid JSON.</p>";
      });
    }

    function renderCourseDetail(course, holes) {
      var container = document.getElementById("courseDetail");
      if (!course) {
        container.innerHTML = "<p class='error'>No course JSON loaded.</p>";
        return;
      }

      var tees = Array.isArray(course.tees) ? course.tees : [];
      var hasHoles = Array.isArray(holes) && holes.length > 0;

      // TEES LEGEND
      var teesInfo = "";
      if (tees.length) {
        tees.forEach(function(t) {
          var color = t.color || "#e5e7eb";
          var name = t.name || t.id;
          teesInfo +=
            "<span>" +
              "<span class='tee-dot' style='background:" + color + ";'></span>" +
              name +
              (t.totalYardage ? " · " + t.totalYardage + " yds" : "") +
            "</span>";
        });
      } else {
        teesInfo = "<span>No tees defined yet in <code>course.json</code>.</span>";
      }

      // If no holes yet, show simple message
      if (!hasHoles) {
        var loc = course.location || {};
        var locLine = "";
        if (loc.city) locLine += loc.city;
        if (loc.city && loc.state) locLine += ", ";
        if (loc.state) locLine += loc.state;
        if (course.holes) {
          if (locLine) locLine += " · ";
          locLine += course.holes + " holes";
        }

        var notesBadge = course.notes
          ? "<span class='badge'>" + course.notes + "</span>"
          : "";

        container.innerHTML =
          "<div class='course-header'>" +
            "<div class='course-header-main'>" +
              "<h3>" + (course.name || "Unnamed Course") + "</h3>" +
              "<p>" + (locLine || "") + "</p>" +
            "</div>" +
            "<div class='course-badges'>" +
              "<span class='badge badge-pill'>Local DB</span>" +
              notesBadge +
            "</div>" +
          "</div>" +
          "<div id='teesInfo'>" + teesInfo + "</div>" +
          "<p class='muted'>No holes.json data yet – once you start filling in hole info, it will appear here as a scorecard.</p>";
        return;
      }

      // ===== Build scorecard-style layout =====
      // Determine max hole and front/back split
      var maxHole = 0;
      holes.forEach(function(h, idx) {
        var num = h.hole || (idx + 1);
        if (num > maxHole) maxHole = num;
      });

      var frontEnd = Math.min(9, maxHole);
      var backStart = frontEnd + 1;
      var hasBack = maxHole > frontEnd;

      // Collect per-hole data
      var parByHole = {};
      var hdcpByHole = {};
      var yardagesByTeeHole = {};
      var parFront = 0;
      var parBack = 0;
      var parTotal = 0;

      var teeTotals = {}; // teeId -> { front, back, total }

      holes.forEach(function(h, idx) {
        var holeNum = h.hole || (idx + 1);
        parByHole[holeNum] = h.par;
        hdcpByHole[holeNum] = h.handicap;

        if (typeof h.par === "number") {
          if (holeNum <= frontEnd) parFront += h.par;
          else parBack += h.par;
          parTotal += h.par;
        }

        if (h.yardages && typeof h.yardages === "object") {
          tees.forEach(function(t) {
            var teeId = t.id;
            var y = h.yardages[teeId];
            if (typeof y === "number") {
              if (!yardagesByTeeHole[teeId]) yardagesByTeeHole[teeId] = {};
              yardagesByTeeHole[teeId][holeNum] = y;

              if (!teeTotals[teeId]) {
                teeTotals[teeId] = { front: 0, back: 0, total: 0 };
              }
              if (holeNum <= frontEnd) teeTotals[teeId].front += y;
              else teeTotals[teeId].back += y;
              teeTotals[teeId].total += y;
            }
          });
        }
      });

      // ===== Build HTML for scorecard table =====
      var table = "";

      // Header row: Holes
      table += "<thead>";
      table += "<tr>";
      table += "<th></th>"; // row labels (Par, Hdcp, tees)

      // Front 9 hole numbers
      for (var h = 1; h <= frontEnd; h++) {
        table += "<th>" + h + "</th>";
      }

      // OUT column if we have more than frontEnd holes
      if (hasBack) {
        table += "<th class='out-in-col'>OUT</th>";
      }

      // Back 9 hole numbers
      if (hasBack) {
        for (var hb = backStart; hb <= maxHole; hb++) {
          table += "<th>" + hb + "</th>";
        }
        table += "<th class='out-in-col'>IN</th>";
      }

      table += "<th class='total-col'>TOTAL</th>";
      table += "</tr>";
      table += "</thead>";

      // Body rows: Par, Handicap, then Tees
      table += "<tbody>";

      // Par row
      table += "<tr>";
      table += "<th>Par</th>";

      var parFrontOut = 0;
      var parBackIn = 0;

      for (var h2 = 1; h2 <= frontEnd; h2++) {
        var ph = parByHole[h2];
        if (typeof ph === "number") parFrontOut += ph;
        table += "<td>" + (typeof ph === "number" ? ph : "–") + "</td>";
      }

      if (hasBack) {
        table += "<td class='out-in-col'>" + (parFrontOut || "–") + "</td>";
      }

      if (hasBack) {
        for (var hb2 = backStart; hb2 <= maxHole; hb2++) {
          var phb = parByHole[hb2];
          if (typeof phb === "number") parBackIn += phb;
          table += "<td>" + (typeof phb === "number" ? phb : "–") + "</td>";
        }
        table += "<td class='out-in-col'>" + (parBackIn || "–") + "</td>";
      }

      table += "<td class='total-col'>" + (parTotal || "–") + "</td>";
      table += "</tr>";

      // Handicap row
      table += "<tr>";
      table += "<th>Hdcp</th>";

      for (var h3 = 1; h3 <= frontEnd; h3++) {
        var hd = hdcpByHole[h3];
        table += "<td>" + ((hd === 0 || hd) ? hd : "–") + "</td>";
      }

      if (hasBack) {
        table += "<td class='out-in-col'></td>";
      }

      if (hasBack) {
        for (var hb3 = backStart; hb3 <= maxHole; hb3++) {
          var hdb = hdcpByHole[hb3];
          table += "<td>" + ((hdb === 0 || hdb) ? hdb : "–") + "</td>";
        }
        table += "<td class='out-in-col'></td>";
      }

      table += "<td class='total-col'></td>";
      table += "</tr>";

      // Tees rows
      tees.forEach(function(t) {
        var teeId = t.id;
        var teeName = t.name || teeId;
        var teeColor = t.color || "#e5e7eb";

        var totals = teeTotals[teeId] || { front: 0, back: 0, total: 0 };

        table += "<tr>";
        table += "<th>";
        table += "<span class='tee-name-cell'>";
        table += "<span class='tee-name-swatch' style='background:" + teeColor + ";'></span>";
        table += "<span>" + teeName + "</span>";
        table += "</span>";
        table += "</th>";

        for (var h4 = 1; h4 <= frontEnd; h4++) {
          var yh = yardagesByTeeHole[teeId] && yardagesByTeeHole[teeId][h4];
          table += "<td>" + (typeof yh === "number" ? yh : "–") + "</td>";
        }

        if (hasBack) {
          table += "<td class='out-in-col'>" + (totals.front || "–") + "</td>";
        }

        if (hasBack) {
          for (var hb4 = backStart; hb4 <= maxHole; hb4++) {
            var yhb = yardagesByTeeHole[teeId] && yardagesByTeeHole[teeId][hb4];
            table += "<td>" + (typeof yhb === "number" ? yhb : "–") + "</td>";
          }
          table += "<td class='out-in-col'>" + (totals.back || "–") + "</td>";
        }

        table += "<td class='total-col'>" + (totals.total || "–") + "</td>";
        table += "</tr>";
      });

      table += "</tbody>";

      // Footer row: just labels for front/back groups (optional subtle touch)
      table += "<tfoot>";
      table += "<tr>";
      table += "<td></td>";
      for (var h5 = 1; h5 <= frontEnd; h5++) {
        table += "<td></td>";
      }
      if (hasBack) {
        table += "<td class='out-in-col'>Front 9</td>";
        for (var hb5 = backStart; hb5 <= maxHole; hb5++) {
          table += "<td></td>";
        }
        table += "<td class='out-in-col'>Back 9</td>";
      }
      table += "<td class='total-col'>Round</td>";
      table += "</tr>";
      table += "</tfoot>";

      // Course header/location line
      var loc = course.location || {};
      var locLine = "";
      if (loc.city) locLine += loc.city;
      if (loc.city && loc.state) locLine += ", ";
      if (loc.state) locLine += loc.state;
      if (course.holes) {
        if (locLine) locLine += " · ";
        locLine += course.holes + " holes";
      }

      var notesBadge2 = course.notes
        ? "<span class='badge'>" + course.notes + "</span>"
        : "";

      container.innerHTML =
        "<div class='course-header'>" +
          "<div class='course-header-main'>" +
            "<h3>" + (course.name || "Unnamed Course") + "</h3>" +
            "<p>" + (locLine || "") + "</p>" +
          "</div>" +
          "<div class='course-badges'>" +
            "<span class='badge badge-pill'>Local DB</span>" +
            notesBadge2 +
          "</div>" +
        "</div>" +
        "<div id='teesInfo'>" + teesInfo + "</div>" +
        "<div class='scorecard-wrapper'>" +
          "<table class='scorecard'>" +
            table +
          "</table>" +
        "</div>";
    }

    loadCourses();
  </script>
</body>
</html>
