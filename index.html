<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Course Information – Local Golf Database</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --green: #244f3c;
      --green-dark: #163023;
      --gold: #d1a14b;
      --cream: #f5f0e6;
      --bg: #fcfaf6;
      --text: #222;
      --radius: 14px;
      --shadow: 0 10px 28px rgba(0,0,0,.08);
      --muted: #6b7280;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #fdf7eb 0, #f3efe7 40%, #e7e1d3 100%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 16px 24px;
      background: linear-gradient(120deg, var(--green-dark), var(--green));
      color: #fefcf5;
      box-shadow: 0 4px 18px rgba(0,0,0,.25);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    header h1 {
      margin: 0;
      font-size: 1.4rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }

    header p {
      margin: 4px 0 0;
      font-size: 0.9rem;
      opacity: 0.9;
    }

    main {
      flex: 1;
      display: grid;
      grid-template-columns: minmax(220px, 260px) minmax(0, 1fr);
      gap: 16px;
      padding: 16px;
    }

    @media (max-width: 768px) {
      main {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      background: rgba(252, 249, 242, 0.95);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      border: 1px solid rgba(0,0,0,0.04);
      padding: 14px 16px;
      backdrop-filter: blur(8px);
    }

    .panel h2 {
      margin: 0 0 8px;
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--green-dark);
    }

    .panel small {
      color: var(--muted);
    }

    #coursesList {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 8px;
    }

    .course-pill {
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.06);
      background: #fdfaf3;
      display: flex;
      flex-direction: column;
      cursor: pointer;
      transition: transform 0.12s ease, box-shadow 0.12s ease, border-color 0.12s ease, background 0.12s ease;
    }

    .course-pill:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      background: #fffaf0;
    }

    .course-pill.active {
      background: #183c2c;
      color: #fdf7eb;
      border-color: rgba(255,255,255,0.4);
    }

    .course-pill-title {
      font-size: 0.95rem;
      font-weight: 600;
    }

    .course-pill-meta {
      font-size: 0.8rem;
      opacity: 0.85;
    }

    .course-header {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 12px;
      border-bottom: 1px solid rgba(0,0,0,0.06);
      padding-bottom: 8px;
    }

    .course-header-main h3 {
      margin: 0;
      font-size: 1.1rem;
    }

    .course-header-main p {
      margin: 2px 0 0;
      font-size: 0.85rem;
      color: var(--muted);
    }

    .course-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .badge {
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
      border: 1px solid rgba(0,0,0,0.06);
      background: #f6f1e6;
      color: var(--green-dark);
      white-space: nowrap;
    }

    .badge-pill {
      background: #183c2c;
      color: #fefcf5;
      border-color: transparent;
    }

    #teesInfo {
      margin-bottom: 12px;
      font-size: 0.85rem;
      color: var(--muted);
    }

    #teesInfo span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      margin-right: 10px;
      margin-bottom: 4px;
      padding: 3px 7px;
      border-radius: 999px;
      background: rgba(0,0,0,0.03);
    }

    .tee-dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.15);
      background: #e5e7eb;
    }

    .table-wrapper {
      max-width: 100%;
      overflow-x: auto;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,0.06);
      background: #fffdf6;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.86rem;
    }

    thead {
      background: #f3ede0;
    }

    th, td {
      padding: 6px 8px;
      text-align: center;
      border-bottom: 1px solid rgba(0,0,0,0.04);
      white-space: nowrap;
    }

    th:first-child, td:first-child {
      text-align: left;
      position: sticky;
      left: 0;
      background: inherit;
    }

    tr:nth-child(even) td {
      background: rgba(0,0,0,0.01);
    }

    tfoot td {
      font-weight: 600;
      background: #f0e7d6;
      border-top: 1px solid rgba(0,0,0,0.08);
    }

    .muted {
      color: var(--muted);
      font-size: 0.9rem;
    }

    .error {
      color: #b91c1c;
      font-size: 0.9rem;
      margin-top: 6px;
    }
  </style>
</head>
<body>
  <header>
    <h1>Local Course Information</h1>
    <p>A lightweight yardage book. Data lives in /data; this page just reads it.</p>
  </header>

  <main>
    <section class="panel">
      <h2>Courses</h2>
      <small>Select a course to view its holes, pars, and tee yardages.</small>
      <div id="coursesList"></div>
      <div id="coursesError" class="error" style="display:none;"></div>
    </section>

    <section class="panel">
      <h2>Course Detail</h2>
      <div id="courseDetail">
        <p class="muted">Choose a course on the left to see its hole data.</p>
      </div>
    </section>
  </main>

  <script>
    var COURSES_INDEX_PATH = "data/courses.json";

    function fetchJSON(path) {
      return fetch(path).then(function(res) {
        if (!res.ok) {
          throw new Error("HTTP " + res.status + " for " + path);
        }
        return res.json();
      });
    }

    function loadCourses() {
      var listEl = document.getElementById("coursesList");
      var errorEl = document.getElementById("coursesError");
      listEl.innerHTML = "<p class='muted'>Loading courses…</p>";
      errorEl.style.display = "none";

      fetchJSON(COURSES_INDEX_PATH)
        .then(function(courses) {
          if (!Array.isArray(courses) || courses.length === 0) {
            listEl.innerHTML = "<p class='muted'>No courses found in data/courses.json.</p>";
            return;
          }
          renderCourseList(courses);
          var first = courses[0];
          if (first) {
            setActiveCoursePill(first.id);
            loadCourse(first.id);
          }
        })
        .catch(function(err) {
          console.error("[courses] Failed to load", err);
          listEl.innerHTML = "";
          errorEl.textContent = "Could not load " + COURSES_INDEX_PATH + " – " + err.message;
          errorEl.style.display = "block";
        });
    }

    function renderCourseList(courses) {
      var listEl = document.getElementById("coursesList");
      listEl.innerHTML = "";

      courses.forEach(function(course) {
        var pill = document.createElement("button");
        pill.type = "button";
        pill.className = "course-pill";
        pill.dataset.courseId = course.id;

        var title = document.createElement("span");
        title.className = "course-pill-title";
        title.textContent = course.name || "Unnamed Course";

        var meta = document.createElement("span");
        meta.className = "course-pill-meta";

        var city = course.city || "";
        var state = course.state || "";
        var holes = course.holes;

        var metaText = city;
        if (city && state) {
          metaText += ", " + state;
        } else if (state) {
          metaText = state;
        }
        if (holes) {
          if (metaText) metaText += " · ";
          metaText += holes + " holes";
        }
        meta.textContent = metaText;

        pill.appendChild(title);
        pill.appendChild(meta);

        pill.addEventListener("click", function() {
          setActiveCoursePill(course.id);
          loadCourse(course.id);
        });

        listEl.appendChild(pill);
      });
    }

    function setActiveCoursePill(courseId) {
      var pills = document.querySelectorAll(".course-pill");
      pills.forEach(function(pill) {
        pill.classList.toggle("active", pill.dataset.courseId === courseId);
      });
    }

    function loadCourse(courseId) {
      var container = document.getElementById("courseDetail");
      container.innerHTML = "<p class='muted'>Loading course data…</p>";

      var basePath = "data/courses/" + courseId;
      var coursePath = basePath + "/course.json";
      var holesPath = basePath + "/holes.json";

      Promise.all([
        fetchJSON(coursePath),
        fetchJSON(holesPath)
      ])
      .then(function(results) {
        var course = results[0];
        var holes = results[1];
        renderCourseDetail(course, holes);
      })
      .catch(function(err) {
        console.error("[course] Failed to load", courseId, err);
        container.innerHTML =
          "<p class='error'>Could not load <code>" +
          courseId +
          "</code> data. Check that <code>" +
          coursePath +
          "</code> and <code>" +
          holesPath +
          "</code> exist and are valid JSON.</p>";
      });
    }

    function renderCourseDetail(course, holes) {
      var container = document.getElementById("courseDetail");
      if (!course) {
        container.innerHTML = "<p class='error'>No course JSON loaded.</p>";
        return;
      }

      var tees = Array.isArray(course.tees) ? course.tees : [];

      var totals = {
        par: 0,
        yardages: {}
      };

      var hasHoles = Array.isArray(holes) && holes.length > 0;

      if (hasHoles) {
        holes.forEach(function(h, idx) {
          if (typeof h.par === "number") totals.par += h.par;
          if (h.yardages && typeof h.yardages === "object") {
            tees.forEach(function(tee) {
              var y = h.yardages[tee.id];
              if (typeof y === "number") {
                if (!totals.yardages[tee.id]) totals.yardages[tee.id] = 0;
                totals.yardages[tee.id] += y;
              }
            });
          }
        });
      }

      var teesInfo = "";
      if (tees.length) {
        tees.forEach(function(t) {
          var color = t.color || "#e5e7eb";
          teesInfo +=
            "<span>" +
            "<span class='tee-dot' style='background:" + color + ";'></span>" +
            (t.name || t.id) +
            (t.totalYardage ? " · " + t.totalYardage + " yds" : "") +
            "</span>";
        });
      } else {
        teesInfo = "<span>No tees defined yet in <code>course.json</code>.</span>";
      }

      var tableMarkup = "";
      if (!hasHoles) {
        tableMarkup =
          "<p class='muted'>No holes.json data yet – once you start filling in hole info, it will appear here.</p>";
      } else {
        var headerTees = "";
        tees.forEach(function(t) {
          headerTees += "<th>" + (t.name || t.id) + "</th>";
        });

        var rows = "";
        holes.forEach(function(h, idx) {
          var holeNum = h.hole || (idx + 1);
          var par = (h.par === 0 || h.par) ? h.par : "–";
          var hdcp = (h.handicap === 0 || h.handicap) ? h.handicap : "–";

          var yardageCells = "";
          tees.forEach(function(t) {
            var y = h.yardages && h.yardages[t.id];
            yardageCells += "<td>" + (typeof y === "number" ? y : "–") + "</td>";
          });

          rows +=
            "<tr>" +
            "<td>" + holeNum + "</td>" +
            "<td>" + par + "</td>" +
            "<td>" + hdcp + "</td>" +
            yardageCells +
            "</tr>";
        });

        var totalYardageCells = "";
        tees.forEach(function(t) {
          var totalY = totals.yardages[t.id];
          totalYardageCells += "<td>" + (typeof totalY === "number" ? totalY : "–") + "</td>";
        });

        tableMarkup =
          "<div class='table-wrapper'>" +
          "<table>" +
          "<thead>" +
          "<tr>" +
          "<th>Hole</th>" +
          "<th>Par</th>" +
          "<th>Hdcp</th>" +
          headerTees +
          "</tr>" +
          "</thead>" +
          "<tbody>" +
          rows +
          "</tbody>" +
          "<tfoot>" +
          "<tr>" +
          "<td>Total</td>" +
          "<td>" + (totals.par || "–") + "</td>" +
          "<td></td>" +
          totalYardageCells +
          "</tr>" +
          "</tfoot>" +
          "</table>" +
          "</div>";
      }

      var loc = course.location || {};
      var locLine = "";
      if (loc.city) locLine += loc.city;
      if (loc.city && loc.state) locLine += ", ";
      if (loc.state) locLine += loc.state;
      if (course.holes) {
        if (locLine) locLine += " · ";
        locLine += course.holes + " holes";
      }

      var notesBadge = course.notes
        ? "<span class='badge'>" + course.notes + "</span>"
        : "";

      container.innerHTML =
        "<div class='course-header'>" +
          "<div class='course-header-main'>" +
            "<h3>" + (course.name || "Unnamed Course") + "</h3>" +
            "<p>" + (locLine || "") + "</p>" +
          "</div>" +
          "<div class='course-badges'>" +
            "<span class='badge badge-pill'>Local DB</span>" +
            notesBadge +
          "</div>" +
        "</div>" +
        "<div id='teesInfo'>" +
          teesInfo +
        "</div>" +
        tableMarkup;
    }

    loadCourses();
  </script>
</body>
</html>
